<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sistema de Login e Usuários</title>
    <link href="../output.css" rel="stylesheet" />
  </head>
  <body
    class="bg-gradient-to-br from-lime-200 to-green flex items-center justify-center min-h-screen flex-col"
  >
    <div
      class="bg-gray-50/20 backdrop-blur-xl flex flex-col p-10 rounded-s-sm items-center gap-8 shadow-2xl border-1 border-white"
    >
      <div class="userPhoto">
        <img
          src="felipe.webp"
          id="imgUser"
          class="rounded-full border-3 bg-green border-white"
          width="200px"
        />
      </div>
      <div class="loginForm">
        <h1 class="text-center text-3xl font-medium text-white">Login</h1>
        <form id="loginForm" class="w-80 flex flex-col">
          <label for="user" class="text-white">Usuário:</label>
          <input
            type="text"
            id="user"
            name="user"
            placeholder="Digite Seu Usuário"
            required
            class="p-2 border rounded-md shadow-2xl focus:border-green focus:ring-1 focus:ring-green focus:outline-none text-white transition-all"
          />
          <br />
          <label for="password" class="text-white">Senha:</label>
          <input
            type="password"
            id="password"
            placeholder="Digite Sua Senha"
            name="password"
            required
            class="p-2 border rounded-md shadow-2xl focus:border-green focus:ring-1 focus:ring-green focus:outline-none text-white transition-all"
          />
          <br />
          <button
            type="submit"
            class="bg-green-700 p-2 rounded-md text-white text-2x1 hover: cursor-pointer hover:bg-green-900 hover:scale-105 transform transition-all duration-200 hover:shadow-md"
          >
            Login
          </button>
        </form>
      </div>
    </div>
    <br />

    <!-- Formulário de Cadastro de Usuário -->
    <h2 style="display: none">Cadastrar Novo Usuário</h2>
    <form id="signupForm" style="display: flex">
      <label for="newUser">Usuário:</label>
      <input type="text" id="newUser" name="user" required />
      <br />
      <label for="newPassword">Senha:</label>
      <input type="password" id="newPassword" name="password" required />
      <br />
      <label for="newCargoId">Cargo:</label>
      <input type="number" id="newCargoId" name="cargo_id" required />
      <br />
      <label for="newImage">URL da Imagem:</label>
      <input type="file" id="imgUserInput" required />
      <br />
      <button type="submit">Cadastrar</button>
    </form>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      document
        .getElementById("loginForm")
        .addEventListener("submit", function (event) {
          event.preventDefault();

          const user = document.getElementById("user").value;
          const password = document.getElementById("password").value;

          axios
            .post("http://localhost:3333/user/login", {
              user: user,
              password: password,
            })
            .then((response) => {
              alert(response.data.message);
              if (response.data.token) {
                localStorage.setItem("token", response.data.token);
                console.log("Token armazenado:", response.data.token);
              }

              if (response.data.urlImagem) {
                document.getElementById("imgUser").src =
                  response.data.urlImagem;
              }

              localStorage.setItem("imagemUsuario", response.data.urlImagem);

              setTimeout(() => {
                window.location.href = "/front-end/src/admin/index.html";
              }, 1500);
            })
            .catch((error) => {
              alert(error.response.data.message || "Erro desconhecido");
              console.error(error);
            });
        });

      document
        .getElementById("signupForm")
        .addEventListener("submit", function (event) {
          event.preventDefault();

          const user = document.getElementById("newUser").value;
          const password = document.getElementById("newPassword").value;
          const cargoId = document.getElementById("newCargoId").value;
          const imgUserInput = document.getElementById("imgUserInput");
          const imgUserPhoto = imgUserInput.files[0];

          const formData = new FormData();
          formData.append("user", user);
          formData.append("senha", password);
          formData.append("cargo_id", cargoId);
          formData.append("imgUserPhoto", imgUserPhoto);

          axios
            .post("http://localhost:3333/user/create", formData)
            .then((response) => {
              alert(response.data.message);
            })
            .catch((error) => {
              alert(error.response.data.message || "Erro desconhecido");
              console.error(error);
            });
        });
    </script>
  </body>
</html>
